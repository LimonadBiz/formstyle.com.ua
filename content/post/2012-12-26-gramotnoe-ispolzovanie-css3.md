---
title: Грамотное использование CSS3
author: admin
type: post
date: 2012-12-26T15:46:21+00:00
url: /gramotnoe-ispolzovanie-css3/
categories:
  - Css 3

---
Итак, вы убедились, что добавление кода CSS3 на веб-страницы способно принести огромную пользу. Означает ли это, что уже можно начинать заполнять таблицы стилей разнообразными функциями CSS3 и радоваться жизни? В целом да, но я бы не рекомендовала бросаться в омут с головой, не познакомившись для начала с некоторыми наработанными практиками. Как и с CSS 2.1, с CSS3 связаны определенные соображения, которые необходимо учитывать при построении таблиц стилей, для того чтобы у вас получались хорошо организованные, эффективные и не устаревающие со временем документы. Вы должны уметь реализовывать CSS3 так, чтобы не причинять вреда не поддерживающим эти технологии браузерам и при необходимости добавлять для таких браузеров обходные пути.

Браузерные префиксы

Когда разработчики браузера внедряют новое свойство, значение или селектор, еще не перешедшее в статус Candidate Recommendation (Кандидат в рекомендации), они добавляют в начале свойства префикс с кодом механизма рендеринга. Например, -moz-border-radius — это версия свойства border-radius, которая в настоящее время используется в браузерах на базе Mozilla, таких как Firefox. В табл. 1.4 приведен список всех доступных префиксов.

Браузерные префиксы свойств CSS

<table border="1">
  <tr>
    <td>
      Префикс
    </td>
    
    <td>
      Механизмрендеринга
    </td>
    
    <td>
      Популярные браузеры на базе этого механизма рендеринга
    </td>
  </tr>
  
  <tr>
    <td>
      -khtml-
    </td>
    
    <td>
      KHTML
    </td>
    
    <td>
      Konqueror
    </td>
  </tr>
  
  <tr>
    <td>
      -ms-
    </td>
    
    <td>
      Trident
    </td>
    
    <td>
      Internet Explorer
    </td>
  </tr>
  
  <tr>
    <td>
      -moz-
    </td>
    
    <td>
      Mozilla
    </td>
    
    <td>
      Firefox, Camino, Flock
    </td>
  </tr>
  
  <tr>
    <td>
      -o-*
    </td>
    
    <td>
      Presto
    </td>
    
    <td>
      Opera, Opera Mobile, Opera Mini, браузер Nintendo Wii
    </td>
  </tr>
  
  <tr>
    <td>
      -webkit-
    </td>
    
    <td>
      Webkit
    </td>
    
    <td>
      Safari, Safari для iOS, Chrome, браузер Android
    </td>
  </tr>
</table>

В механизме рендеринга Presto свойства, связанные с речью, предваряются префиксом -xv-, а не -о-.

В этой книге мы будем использовать префиксы -moz-, -o- и -webkit-. Прочие не так широко используются и не потребуются для рассматриваемых методов.

Зачем они нужны

Уникальные для производителей префиксы позволяют разработчикам испытывать новые свойства, значения и селекторы до того, как соответствующие спецификации будут завершены, — это отличный способ протестировать их «в полевых условиях», понять, требуют ли они корректировки и доработки. Если бы разработчики сразу начали использовать стандартные свойства, не дополненные префиксами, им пришлось бы ограничиваться исключительно поведением, предусмотренным для этих свойств первоначально.

В таком случае, продолжая применять стандартные свойства, разработчики ожидали бы, что их поведение останется единообразным и предсказуемым. Если через какое-то время создатели браузеров поменяют то или иное свойство — например, из-за ошибок в первоначальной реализации или изменений самой спецификации — это поставит под угрозу целостность всех существующих сайтов, на которых данное свойство уже используется. Получается, что не только разработчики оказываются в плену у первой несовершенной реализации — пример с них приходится брать и создателям всех браузеров, и даже самому консорциуму W3C. Эрик Мейер (Eric Meyer) в своей превосходной статье «Prefix or Posthack» приводит два примера такого неудачного развития событий, взятых из реальной жизни (http://www.alistapart.com/articles/prefix-or-posthack).

Но даже если создатели одного браузера не меняют реализацию свойств, чтобы не сломать существующие сайты, это может сделать W3C. Что произойдет, если создатели остальных браузеров станут применять новое поведение, описанное в обновленной спецификации? В разных браузерах одно и то же стандартное свойство будет отображаться по-разному. Именно так обстояли дела во времена Netscape 4, Mac IE 5 и Windows IE 6. Число сложных и нестабильных исправлений посторонних ошибок, совершенно не связанных со свойствами, первоначально требовавшими корректировки, быстро увеличивалось, потому что нестандартное поведение браузера не изолировалось от окружающего мира в уникальных для этого браузера свойствах.

Разработчики понимают, что свойства с префиксами — экспериментальные и могут быть изменены. Это дает создателям браузеров дополнительную свободу, позволяя при необходимости вносить изменения и, следовательно, быстрее выпускать и исправлять новые свойства. Разработчики сайтов и приложений, в свою очередь, скорее получают возможность применить новые свойства и поучаствовать в процессе доработки путем тестирования в реальных условиях.

Когда спецификация достигает более стабильного состояния, а разработчикам браузеров удается добиться правильной реализации свойства, от префикса можно избавляться. Если разработчики сайтов добавили в свои таблицы стилей версию свойства без префикса — а делать это весьма полезно, чтобы не создавать проблем с совместимостью в будущем, — веб-страницы автоматически начинают отображаться в соответствии с последними изменениями в спецификации свойства. Если же они не предусмотрели версию свойства без префикса, то ничего страшного не произойдет — она продолжает работать так же, как раньше. Ни один из сайтов, где используется версия с префиксом, не сломается.

Проблемы с префиксами

Разумеется, у браузерных префиксов есть и определенные недостатки. В основном разработчики сайтов жалуются на то, что для того чтобы добиться единственного эффекта, им приходится добавлять сразу несколько строк кода, например:

div {

-moz-transform: rotate(45deg);

-o-transform: rotate(45deg);

-webkit-transform: rotate(45deg); transform: rotate(45deg);

<sup>}</sup>

Повторение почти одинаковых строк кода увеличивает размер файлов, содержащих таблицы стилей. Кроме того, это раздражает. Код выглядел бы намного проще и аккуратнее, если бы содержал одну строку со стандартным свойством. Вообще-то, многие сценарии препроцессора CSS позволяют делать именно так: вы вписываете свойство без префикса, а они создают для вас код CSS, ориентированный на определенный браузер. Среди инструментов, поддерживающих такое поведение, можно перечислить Sass (http://sass-lang.com/), LESS (http://lesscss.org/) и eCSStender (http://www.alistapart.com/articles/stop-forking-with-css3). Разумеется, существуют и другие. Но и у этого подхода с использованием сценариев для удаления префиксов есть свои недостатки. Если свойство в каком-то браузере реализовано с ошибками, то невозможно сделать так, чтобы префикс этого браузера не использовался, но в то же время сохранить префиксы остальных браузеров. Помимо этого, невозможно указать для разных браузеров разные значения свойства, позволяющие скорректировать небольшие различия, появляющиеся при его визуализации. Также не забывайте, что добавление сценариев может привести к замедлению страниц. Эрик Мейер в уже упомянутой выше статье (http://www.alistapart.com/articles/prefix-or-posthack) объясняет самые большие опасности данного метода:

Пряча свойства с префиксами за бетонной стеной процессора, авторы порой забывают, что элемент, который они используют, все еще находится на экспериментальной стадии и может поменяться. Они неосознанно начинают относиться к нему как к проработанному и стабильному, хотя до этого может быть еще далеко.

Хотя постоянное повторение браузерных префиксов раздражает и делает код громоздким, альтернативный вариант — разное поведение стандартного свойства в разных браузерах, приводящее к необходимости использовать множество изощренных «заплаток», — может принести куда больше неприятностей. К тому же с течением времени уровень поддержки только повышается, вы постепенно удаляете префиксы свойств и делаете свой код чище и понятнее, а не мучаетесь годами с поддержкой «заплаток» в таблицах свойств из-за одного свойства без префикса, приводящего к нестандартному поведению браузера. Позвольте мне еще раз процитировать статью Эрика Мейера, где он говорит о преходящей природе «префиксных мучений»:

Это похоже на прививку: место укола может немного поболеть, но легкая непродолжительная боль — ничто по сравнению с тем, что вы испытали бы, заболев по-настоящему. И в данном случае вы получаете прививку от многолетней неравной борьбы с синтаксическим анализатором и хронического «вынюхивания» браузера. Мы уже однажды пережили эту чуму. При правильном использовании префиксы смогут надежно защитить нас от очередной волны невзгод.

<div>
  <p>
    Когда все готово к удалению определенных префиксов из кода CSS, для того чтобы сделать это, можно воспользоваться регулярными выражениями (см. http://www.venturelab.co.uk/devblog/2010/07/vendor-prefixes-what-happens-next).
  </p>
</div>

&nbsp;

Еще один недостаток — префиксы не проходят проверку. Проверка представляет собой всего лишь инструмент устранения неполадок, поэтому если вы видите ошибку свойства с префиксом, то можете просто игнорировать ее и продолжать работать. Но если к целой куче «неопасных» ошибок примешиваются другие, на которые необходимо обратить внимание, их становится сложнее выловить и устранить реальные неполадки.

Для того чтобы смягчить последствия обеих проблем — повторяющихся строк в коде и невозможности проверки, — некоторые разработчики выделяют свойства с префиксами в отдельную таблицу стилей. Таким образом, основная таблица стилей сохраняется в первоначальном состоянии и успешно проходит проверку (или, по крайней мере, позволяет выявлять «настоящие» ошибки). Однако многие разработчики CSS (включая меня) — не сторонники такого подхода. Во-первых, при этом добавляется еще один HTTP-запрос, что влияет на производительность намного сильнее, чем увеличение основной таблицы стилей на несколько байт из-за свойств с префиксами. Во-вторых, так вы с большей вероятностью забудете о том, что используете свойства с префиксами, а поскольку при работе с ними нужно проявлять намного больше осторожности, крайне важно обращать на них дополнительное внимание. Если разработчики браузера поменяют поведение одного из свойств с префиксом, вы можете позабыть о необходимости обновить правила. Или же, пытаясь сообразить, почему определенная функциональность или элемент работает так, а не иначе, вы можете потратить на поиск неполадки дополнительное время, не вспомнив вовремя о существовании дополнительной таблицы стилей. Мне неприятно это говорить, но фильтрация ошибок проверки в поисках действительно значимых сообщений — это меньшее зло по сравнению с ведением отдельной таблицы стилей для свойств с префиксами.

Несмотря на все их недостатки, большинство разработчиков CSS рады существованию префиксов для свойств и разделяют мнение, что преимущества, о которых я рассказала выше, оправдывают использование префиксов в подходящих ситуациях.

Правильное использование зависящих от браузера свойств

При добавлении в код свойства с префиксом необходимо также всегда включать и вариант этого свойства без префикса, причем помещать его нужно после версии с префиксом. Так вы гарантируете, что браузеры, поддерживающие свойство без префикса, будут использовать именно его, переопределяя свойство с префиксом, указанное в коде чуть раньше, и реализуя новое, более правильное поведение.

Например, до выпуска версии Safari 5 в этом браузере использовалось свойство -webkit-border-radius. И очень хорошо, что так было, потому что его реализация содержала пару ошибок (или, вернее, там появилась пара ошибок после того, как W3C уточнил спецификацию). К примеру, в Safari 4 и более ранних версиях нельзя было скруглять отдельные углы независимо друг от друга с помощью свойства -webkit-border-radius, хотя в спецификации говорилось, что это возможно. Кроме того, для указания кривизны эллиптической дуги (в противоположность дуге, составляющей часть идеальной окружности) применялся неправильный синтаксис.

Но не было необходимости избавляться от неправильного синтаксиса, содержащегося в свойстве -webkit-border-radius, ведь его не могли видеть браузеры на основе других механизмов рендеринга, отличных от Webkit. А добавив после этой строки стандартное свойство border-radius, включающее правильный синтаксис, вы смогли воспользоваться преимуществами улучшенной реализации Safari 5, как только она стала доступна, и вам не пришлось менять ни одного символа в таблицах стилей. Стандартное свойство уже было готово к использованию.

Почти всегда рекомендуется добавлять стандартное свойство последним, однако есть несколько редких случаев, когда я бы рекомендовала вовсе не использовать его, ограничиваясь только версиями, зависящими от браузера. Если синтаксис все еще подвергается значительным изменениям, я советую подождать и не включать в код стандартное свойство до тех пор, пока оно не станет более стабильным. Нет никакого смысла в том, чтобы добавлять его, а затем игнорировать или получать сюрприз в виде внезапных сбоев, когда спецификация наконец будет утверждена и браузеры начнут использовать стандартное свойство.

В качестве отличного примера можно привести градиенты, генерируемые с помощью кода CSS3. В главе 2 вы узнаете, что синтаксис W3C для этой возможности все еще находится на начальных этапах разработки, и в Firefox и в Webkit используются свойства с фирменными префиксами и абсолютно разными синтаксисами. Кого-то это побудит полностью отказаться от использования градиентов. Но, с другой стороны, это всего лишь визуальный эффект, безо всяких ошибок исчезающий в не поддерживающих его браузерах, так почему бы не применять его для создания экспериментальных или личных сайтов или сайтов, предназначенных только для одного браузера, таких как приложения iPhone? Если вы решите реализовать градиенты, несмотря на возможные изменения синтаксиса в будущем, то самый безопасный путь для вас — внедрять в код только версии с префиксами. Однако подобные примеры редки, отчасти потому, что разработчики браузеров обычно не создают версию свойства с префиксом до тех пор, пока синтаксис не будет проработан достаточно хорошо. Помимо этого, даже если версия с префиксом создается, разработчики веб-сайтов все же предпочитают дожидаться более стабильного синтаксиса.

Еще одна необязательная рекомендация заключается в том, чтобы делать код избыточным, добавляя все возможные версии с префиксами, даже если некоторые из них вовсе не используются — просто на случай, если позднее они войдут в обиход.

Я не могу сказать, что я абсолютно за или против этого подхода — мне кажется, все зависит от ситуации. Работая над сайтом, который мне придется отдать для поддержки в чужие руки и к которому я, вероятно, больше никогда не прикоснусь, я предпочитаю добавлять все возможные свойства с уникальными префиксами. Но если я знаю, что продолжу поддерживать сайт самостоятельно, то, скорее всего, добавлю только те свойства с префиксами, которые действительно нужны, а остальные допишу позже, если браузеры начнут их поддерживать. Вы можете поступать так, как вам нравится.

<div>
  <p>
    Я хочу показать вам удобную таблицу свойств с префиксами для четырех основных механизмов рендеринга. Она находится по адресу http://peter.sh/experiments/vendor-prefixed-css-property-overview. В этой таблице наглядно показано, какие браузеры используют свойство с префиксом, какие — свойство без префикса, а какие вовсе не используют никакое свойство.
  </p>
</div>

&nbsp;

Независимо от того, какие свойства с префиксами вы решите использовать, хорошей идеей будет добавить в код CSS комментарии, сообщающие, какое свойство соответствует какому браузеру. Может показаться, что это очевидно, однако так бывает далеко не всегда. Например, вот как группа свойств border-radius могла бы выглядеть с комментариями:

-moz-border-radius: 20px; /\* Firefox \*/

-webkit-border-radius: 20px; /\* Safari 4 и более ранние \*/ border-radius: 20px; /\* Opera, Chrome, Safari 5, IE 9 \*/

Добавляя такие комментарии, вы упрощаете себе работу по удалению ненужных свойств в будущем, когда будет принято решение отказаться от поддержки определенного браузера.

<a name="bookmark53"></a>работа с браузерами, не поддерживающими функциональность CSS3

Не существует универсального рецепта для случаев, когда браузер не поддерживает добавляемый вами код CSS3. Какой путь выберете именно вы — зависит от требований конкретного сайта, ваших пользователей, вашего клиента, личных предпочтений и самой техники CSS3, о которой идет речь. Мы обсудим несколько подходов к решению проблемы браузеров без поддержки CSS3 и далее в этой книге применим каждый из них в подходящей ситуации.

Смириться с различиями

Во многих случаях лучший способ справиться с проблемой браузеров, не поддерживающих функциональность CSS3, — просто смириться с различиями в отображении содержимого. В конце концов, именно в этом заключается суть прогрессивного усовершенствования, к тому же в некоторых ситуациях у вас попросту нет выбора и заменить CSS-версию того или иного метода просто нечем. Но даже в ситуациях, когда выбор есть, приходится задавать себе важный вопрос — окупятся ли время и силы, затраченные на реализацию обходного пути для не поддерживающего CSS3 браузера? Выиграют ли от этого пользователи? Повысятся ли показатели продаж или подписки на новостную рассылку или выполнения любой другой задачи, которую сайт призван решать? Если ответ положительный, то вперед, действуйте — реализуйте подходящую замену или обходной путь. Но очень часто приходится признавать, что это вряд ли даст большой выигрыш, ведь CSS3 — это необязательное косметическое улучшение. К тому же добавление обходного пути может ухудшить впечатление пользователя от сайта: например, загрузка изображений в устаревших браузерах замедляет загрузку страницы в целом.

Большинство эффектов CSS3 безвредны для не поддерживающих их браузеров — пользователи их попросту не видят. К примеру, взгляните на веб-сайт Twitter (http://www.twitter.com). В коде сайта свойство border-radius используется для скругления углов в различных местах дизайна; также присутствуют и другие эффекты CSS3, которые в IE 8 и более ранних версиях не отображаются. В современных браузерах,

отличных от IE, углы поля What’s happening? (в котором вы вводите свое сообщение) скругляются, а края при подведении указателя мыши обрамляются голубым сиянием (рис. 1.6). В версиях IE 8 и более ранних это обычное поле с прямыми углами и без сияния (рис. 1.7). В таком представлении нет ничего плохого, и оно не кажется искаженным — просто другое. Различие никак не вредит пользователям IE, поэтому разработчики Twitter не внедряют альтернативные методы для имитации эффектов CSS3.

<a href="http://formstyle.com.ua/gramotnoe-ispolzovanie-css3/v-firefox-u-polya-vvoda-soobshheniya-v-twitter-ugly-skruglennye-a-vdol-kraev-otobrazhaetsya-goluboe-siyanie/" rel="attachment wp-att-831"><img class="aligncenter size-medium wp-image-831" alt="В Firefox у поля ввода сообщения в Twitter углы скругленные, а вдоль краев отображается голубое сияние" src="http://formstyle.com.ua/wp-content/uploads/2012/12/В-Firefox-у-поля-ввода-сообщения-в-Twitter-углы-скругленные-а-вдоль-краев-отображается-голубое-сияние-300x139.png" width="300" height="139" srcset="http://formstyle.com.ua/wp-content/uploads/2012/12/В-Firefox-у-поля-ввода-сообщения-в-Twitter-углы-скругленные-а-вдоль-краев-отображается-голубое-сияние-300x139.png 300w, http://formstyle.com.ua/wp-content/uploads/2012/12/В-Firefox-у-поля-ввода-сообщения-в-Twitter-углы-скругленные-а-вдоль-краев-отображается-голубое-сияние.png 369w" sizes="(max-width: 300px) 100vw, 300px" /></a>

В Firefox у поля ввода сообщения в Twitter углы скругленные, а вдоль краев отображается голубое сияние

<div>
  <p>
    <a href="http://formstyle.com.ua/gramotnoe-ispolzovanie-css3/polzovateli-ie-8-ne-vidyat-skruglennyx-uglov-i-siyaniya-no-alternativnoe-predstavlenie-stranicy-ne-kazhetsya-urodlivym-ili-iskazhennym/" rel="attachment wp-att-841"><img class="aligncenter size-medium wp-image-841" alt="Пользователи IE 8 не видят скругленных углов и сияния, но альтернативное представление страницы не кажется уродливым или искаженным" src="http://formstyle.com.ua/wp-content/uploads/2012/12/Пользователи-IE-8-не-видят-скругленных-углов-и-сияния-но-альтернативное-представление-страницы-не-кажется-уродливым-или-искаженным-300x144.png" width="300" height="144" srcset="http://formstyle.com.ua/wp-content/uploads/2012/12/Пользователи-IE-8-не-видят-скругленных-углов-и-сияния-но-альтернативное-представление-страницы-не-кажется-уродливым-или-искаженным-300x144.png 300w, http://formstyle.com.ua/wp-content/uploads/2012/12/Пользователи-IE-8-не-видят-скругленных-углов-и-сияния-но-альтернативное-представление-страницы-не-кажется-уродливым-или-искаженным.png 381w" sizes="(max-width: 300px) 100vw, 300px" /></a>
  </p>
  
  <p>
    Пользователи IE 8 не видят скругленных углов и сияния, но альтернативное представление страницы не кажется уродливым или искаженным.
  </p>
  
  <p>
    &nbsp;
  </p>
  
  <p>
    Однако нельзя забывать о ситуациях, когда отсутствие обходного пути приводит к ухудшению представления страницы в не поддерживающих CSS3 браузерах. Например, вы сделали фоновый цвет полупрозрачным, применив для этого синтаксис HSLA или RGBA — один из двух новых способов объявления цвета в CSS3. Браузеры, которые не понимают подобные цветовые значения, не связывают с фоном никакой цвет, и фон становится полностью прозрачным. В зависимости от цвета текста и элементов, просвечивающих сквозь прозрачный фон поля, текст может стать абсолютно нечитаемым (рис. 1.8). В подобных случаях мириться с различиями невозможно и нужно обязательно внедрять какой-то обходной путь.
  </p>
  
  <p>
    <a href="http://formstyle.com.ua/gramotnoe-ispolzovanie-css3/v-firefox-sleva-pole-zalivaetsya-poluprozrachnym-fonovym-cvetom-no-v-ie-8-sprava-fonovyj-cvet-ne-otobrazhaetsya-i-tekst-nevozmozhno-prochitat/" rel="attachment wp-att-861"><img class="aligncenter size-medium wp-image-861" alt="В Firefox (слева) поле заливается полупрозрачным фоновым цветом, но в IE 8 (справа) фоновый цвет не отображается и текст невозможно прочитать" src="http://formstyle.com.ua/wp-content/uploads/2012/12/В-Firefox-слева-поле-заливается-полупрозрачным-фоновым-цветом-но-в-IE-8-справа-фоновый-цвет-не-отображается-и-текст-невозможно-прочитать-300x156.png" width="300" height="156" srcset="http://formstyle.com.ua/wp-content/uploads/2012/12/В-Firefox-слева-поле-заливается-полупрозрачным-фоновым-цветом-но-в-IE-8-справа-фоновый-цвет-не-отображается-и-текст-невозможно-прочитать-300x156.png 300w, http://formstyle.com.ua/wp-content/uploads/2012/12/В-Firefox-слева-поле-заливается-полупрозрачным-фоновым-цветом-но-в-IE-8-справа-фоновый-цвет-не-отображается-и-текст-невозможно-прочитать.png 301w" sizes="(max-width: 300px) 100vw, 300px" /></a>
  </p>
  
  <p>
    <a href="http://formstyle.com.ua/gramotnoe-ispolzovanie-css3/ie-8-sprava-fonovyj-cvet-ne-otobrazhaetsya-i-tekst-nevozmozhno-prochitat/" rel="attachment wp-att-871"><img class="aligncenter size-medium wp-image-871" alt="IE 8 (справа) фоновый цвет не отображается и текст невозможно прочитать" src="http://formstyle.com.ua/wp-content/uploads/2012/12/IE-8-справа-фоновый-цвет-не-отображается-и-текст-невозможно-прочитать-300x155.png" width="300" height="155" srcset="http://formstyle.com.ua/wp-content/uploads/2012/12/IE-8-справа-фоновый-цвет-не-отображается-и-текст-невозможно-прочитать-300x155.png 300w, http://formstyle.com.ua/wp-content/uploads/2012/12/IE-8-справа-фоновый-цвет-не-отображается-и-текст-невозможно-прочитать.png 308w" sizes="(max-width: 300px) 100vw, 300px" /></a>
  </p>
  
  <p>
    В Firefox (слева) поле заливается полупрозрачным фоновым цветом, но в IE 8 (справа) фоновый цвет не отображается и текст невозможно прочитать
  </p>
  
  <p>
    Таким образом, для того чтобы определить наилучший план действий, необходимо протестировать веб-сайт во множестве различных браузеров. Очень часто вы будете следовать по буддистскому пути и принимать существующие различия, но иногда такой вариант абсолютно неприемлем.
  </p>
</div>